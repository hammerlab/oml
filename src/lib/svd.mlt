
open Test_utils

module Gen = FGen (struct
  let largest_float = 1e7
end)

let () =
  let max_matrix_size = 10 in
  Test.add_random_test
    ~title:"Svd, we can"
    ~nb_runs:1000
    Gen.(matrix (make_int 1 max_matrix_size) (make_int 1 max_matrix_size) float)
    (fun m ->
      let u, s, vt = svd m in
      let m_rec = Matrices.(prod (prod u (diagonal s)) vt) in
      Matrices.equal ~d:(Util.dx *. 1e9) m m_rec)
    Spec.([just_postcond_pred is_true]);
